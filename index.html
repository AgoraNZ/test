<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Head content here (same as in your provided code) -->
</head>

<body>
    <!-- Body content here (same as in your provided code) -->

    <script>
        // Firebase initialization and configuration (same as in your provided code)

        async function generatePDF() {
            const form = document.getElementById('hygiene-checklist-form');
            const formData = new FormData(form);
            const dairyNumber = formData.get('dairy-number');

            await saveFarmDetails(formData); // Save farm details if not found

            const { jsPDF } = window.jspdf;
            let pdf = new jsPDF('p', 'pt', 'a4');

            // Add logo at full width
            const logoUrl = "gs://dairy-farm-record-system.appspot.com/Picture3.jpg";
            const logo = await fetch(logoUrl).then((res) => res.blob());
            const reader = new FileReader();
            reader.readAsDataURL(logo);
            reader.onload = function () {
                const imgData = reader.result;
                pdf.addImage(imgData, 'JPEG', 0, 40, pdf.internal.pageSize.width, 60); // Full-width logo

                // Additional PDF content generation (same as in your provided code)
            };
        }

        function createChecklistItems() {
            const checklistItems = [
                "Pulsator Airline", "Long Bend Elbows", "Automatic Cup and Remover", "Diaphragm", "Receiving Can",
                // ... other items
                "Inlet Valve", "Non-Return Valve", "Spray Ball", "Agitator", "Silo Door", "Manhole Seal", "Vat Outlet", "Walls in Silo"
            ];

            const autoFillItems = new Set([
                "Inlet Valve", "Non-Return Valve", "Spray Ball", "Agitator",
                "Silo Door", "Manhole Seal", "Vat Outlet", "Walls in Silo"
            ]);

            // Checklist generation and event handling
            checklistItems.forEach(item => {
                const itemContainer = document.createElement('div');
                itemContainer.classList.add('checklist-item');
                const label = document.createElement('label');
                label.textContent = item;
                itemContainer.appendChild(label);

                const statusSelect = document.createElement('select');
                statusSelect.classList.add('form-select');
                statusSelect.innerHTML = `
                    <option value="ok">OK</option>
                    <option value="attention-required">Attention Required</option>
                    <option value="na">N/A</option>
                    <option value="not-checked">Not Checked</option>
                `;
                itemContainer.appendChild(statusSelect);

                const commentsInput = document.createElement('input');
                commentsInput.type = 'text';
                commentsInput.classList.add('form-control');
                commentsInput.placeholder = 'Comments';
                itemContainer.appendChild(commentsInput);

                const imageUpload = document.createElement('input');
                imageUpload.type = 'file';
                imageUpload.classList.add('form-control', 'image-upload');
                imageUpload.style.display = 'none';
                itemContainer.appendChild(imageUpload);

                statusSelect.addEventListener('change', () => {
                    if (statusSelect.value === 'attention-required') {
                        imageUpload.style.display = 'block';
                    } else {
                        imageUpload.style.display = 'none';
                    }

                    // Conditional auto-fill for specified items
                    if (statusSelect.value === 'not-checked' && autoFillItems.has(item)) {
                        commentsInput.value = "Milk in Vat";
                    } else if (commentsInput.value === "Milk in Vat") {
                        commentsInput.value = ""; // Clear if previously auto-filled
                    }
                });

                checklistContainer.appendChild(itemContainer);
            });
        }

        // Offline Caching and Sync
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('https://madkiwi98.github.io/test/service-worker.js')
                .then(() => console.log("Service Worker Registered"))
                .catch(error => console.error("Service Worker Registration Failed:", error));
        }

        async function syncDataWithFirebase() {
            // Offline syncing logic
        }

        window.addEventListener('online', syncDataWithFirebase);

        document.addEventListener("DOMContentLoaded", () => {
            createChecklistItems();
        });
    </script>
</body>

</html>
